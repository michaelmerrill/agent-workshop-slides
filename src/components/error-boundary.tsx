'use client';

import { Component, type ErrorInfo, type ReactNode } from 'react';

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
}

interface State {
  hasError: boolean;
  error?: Error;
}

function ErrorTriangle() {
  return (
    <svg
      fill="none"
      height="250"
      style={{ overflow: 'visible' }}
      viewBox="0 0 138 167"
      width="207"
      xmlns="http://www.w3.org/2000/svg"
    >
      <g>
        <circle
          cx="132"
          cy="113.5"
          fill="#0a0a0a"
          r="32.5"
          shapeRendering="crispEdges"
        />
        <circle
          cx="132"
          cy="113.5"
          r="33"
          shapeRendering="crispEdges"
          stroke="#ffffff24"
        />
      </g>
      <path
        d="M66.4338 5.25L68.4779 1.75L68.9097 2.00216L69.5 0.991427L70.0903 2.00215L70.522 1.74999L72.5662 5.24998L72.1344 5.50214L74.1785 9.00214L74.6103 8.74998L76.6544 12.25L76.2226 12.5021L78.2668 16.0021L78.6985 15.75L80.7426 19.25L80.3109 19.5021L82.355 23.0021L82.7868 22.75L84.8309 26.25L84.3991 26.5021L86.4432 30.0021L86.875 29.75L88.9191 33.25L88.4874 33.5022L90.5315 37.0022L90.9632 36.75L93.0073 40.25L92.5756 40.5022L94.6197 44.0022L95.0515 43.75L97.0956 47.25L96.6638 47.5022L98.7079 51.0022L99.1397 50.75L101.184 54.25L100.752 54.5022L102.796 58.0022L103.228 57.75L105.272 61.25L104.84 61.5022L106.884 65.0022L107.316 64.75L109.36 68.25L108.929 68.5022L110.973 72.0022L111.404 71.75L113.449 75.25L113.017 75.5022L115.061 79.0022L115.493 78.75L117.537 82.25L117.105 82.5022L119.149 86.0022L119.581 85.75L121.625 89.25L121.193 89.5022L123.237 93.0022L123.669 92.75L125.713 96.25L125.281 96.5022L127.326 100.002L127.757 99.75L129.801 103.25L129.37 103.502L131.414 107.002L131.846 106.75L133.89 110.25L133.458 110.502L135.502 114.002L135.934 113.75L137.978 117.25L137.546 117.502L138.129 118.5H136.956V119H132.868V118.5H128.779V119H124.691V118.5H120.603V119H116.515V118.5H112.426V119H108.338V118.5H104.25V119H100.162V118.5H96.0735V119H91.9853V118.5H87.897V119H83.8088V118.5H79.7206V119H75.6323V118.5H71.5441V119H67.4559V118.5H63.3676V119H59.2794V118.5H55.1912V119H51.1029V118.5H47.0147V119H42.9265V118.5H38.8382V119H34.75V118.5H30.6618V119H26.5735V118.5H22.4853V119H18.3971V118.5H14.3088V119H10.2206V118.5H6.13235V119H2.04412V118.5H0.871045L1.45381 117.502L1.02205 117.25L3.06616 113.75L3.49792 114.002L5.54204 110.502L5.11028 110.25L7.1544 106.75L7.58616 107.002L9.63028 103.502L9.19852 103.25L11.2426 99.75L11.6744 100.002L13.7185 96.5022L13.2868 96.25L15.3309 92.75L15.7626 93.0022L17.8067 89.5022L17.375 89.25L19.4191 85.75L19.8509 86.0022L21.895 82.5022L21.4632 82.25L23.5073 78.75L23.9391 79.0022L25.9832 75.5022L25.5515 75.25L27.5956 71.75L28.0273 72.0022L30.0715 68.5022L29.6397 68.25L31.6838 64.75L32.1156 65.0022L34.1597 61.5022L33.7279 61.25L35.7721 57.75L36.2038 58.0022L38.2479 54.5022L37.8162 54.25L39.8603 50.75L40.292 51.0022L42.3362 47.5022L41.9044 47.25L43.9485 43.75L44.3803 44.0022L46.4244 40.5022L45.9926 40.25L48.0368 36.75L48.4685 37.0022L50.5126 33.5022L50.0809 33.25L52.125 29.75L52.5568 30.0022L54.6009 26.5022L54.1691 26.25L56.2132 22.75L56.645 23.0022L58.6891 19.5022L58.2574 19.25L60.3015 15.75L60.7332 16.0022L62.7773 12.5022L62.3456 12.25L64.3897 8.75L64.8215 9.00216L66.8656 5.50216L66.4338 5.25Z"
        stroke="#454545"
        strokeDasharray="4 4"
      />
      <path
        clipRule="evenodd"
        d="M118.006 83.0538L139 119H98.9493C98.6537 117.211 98.5 115.373 98.5 113.5C98.5 99.9938 106.493 88.3544 118.006 83.0538Z"
        fill="#ededed"
        fillRule="evenodd"
      />
    </svg>
  );
}

function SlideBackground({ children }: { children: ReactNode }) {
  return (
    <div className="relative h-full w-full bg-black">
      <div
        className="absolute w-px bg-[#242424]"
        style={{ left: '6.4%', top: 0, bottom: 0 }}
      />
      <div
        className="absolute w-px bg-[#242424]"
        style={{ right: '6.4%', top: 0, bottom: 0 }}
      />
      <div
        className="absolute h-px bg-[#242424]"
        style={{ top: '11.2%', left: '6.4%', right: '6.4%' }}
      />
      <div
        className="absolute h-px bg-[#242424]"
        style={{ bottom: '11.2%', left: '6.4%', right: '6.4%' }}
      />
      <div
        className="absolute flex items-center justify-center"
        style={{
          top: '11.2%',
          left: '6.4%',
          right: '6.4%',
          bottom: '11.2%',
        }}
      >
        {children}
      </div>
      <div
        className="absolute flex items-center gap-3 text-white"
        style={{ bottom: '4%', left: '9%' }}
      >
        <svg
          aria-label="Vercel logotype"
          role="img"
          viewBox="0 0 262 52"
          xmlns="http://www.w3.org/2000/svg"
          className="h-4 fill-white"
        >
          <path
            d="M59.8019 52L29.9019 0L0.00190544 52H59.8019ZM89.9593 49.6328L114.947 2.36365H104.139L86.9018 36.6921L69.6647 2.36365H58.8564L83.8442 49.6328H89.9593ZM260.25 2.36365V49.6329H251.302V2.36365H260.25ZM210.442 31.99C210.442 28.3062 211.211 25.0661 212.749 22.2699C214.287 19.4737 216.431 17.321 219.181 15.812C221.93 14.3029 225.146 13.5484 228.828 13.5484C232.09 13.5484 235.026 14.2585 237.636 15.6788C240.245 17.0991 242.319 19.2074 243.857 22.0036C245.395 24.7998 246.187 28.2174 246.234 32.2564V34.3202H219.88C220.066 37.2496 220.928 39.5576 222.466 41.2442C224.051 42.8864 226.171 43.7075 228.828 43.7075C230.505 43.7075 232.043 43.2637 233.441 42.376C234.839 41.4883 235.888 40.2899 236.587 38.7808L245.745 39.4466C244.626 42.7754 242.529 45.4385 239.453 47.4358C236.377 49.4331 232.835 50.4317 228.828 50.4317C225.146 50.4317 221.93 49.6772 219.181 48.1681C216.431 46.6591 214.287 44.5064 212.749 41.7102C211.211 38.914 210.442 35.6739 210.442 31.99ZM237.006 28.6612C236.68 25.7762 235.771 23.668 234.28 22.3365C232.789 20.9606 230.971 20.2726 228.828 20.2726C226.358 20.2726 224.354 21.0049 222.816 22.4696C221.278 23.9343 220.322 25.9982 219.95 28.6612H237.006ZM195.347 22.3365C196.838 23.5348 197.77 25.1993 198.143 27.3297L207.371 26.8637C207.044 24.1562 206.089 21.8039 204.505 19.8066C202.92 17.8093 200.869 16.278 198.353 15.2128C195.883 14.1032 193.157 13.5484 190.174 13.5484C186.492 13.5484 183.277 14.3029 180.527 15.812C177.777 17.321 175.634 19.4737 174.096 22.2699C172.558 25.0661 171.789 28.3062 171.789 31.99C171.789 35.6739 172.558 38.914 174.096 41.7102C175.634 44.5064 177.777 46.6591 180.527 48.1681C183.277 49.6772 186.492 50.4317 190.174 50.4317C193.25 50.4317 196.046 49.8769 198.563 48.7673C201.079 47.6133 203.13 45.9933 204.714 43.9072C206.299 41.8212 207.254 39.38 207.58 36.5838L198.283 36.1844C197.957 38.5367 197.048 40.3565 195.557 41.6436C194.065 42.8864 192.271 43.5078 190.174 43.5078C187.285 43.5078 185.048 42.5091 183.463 40.5118C181.879 38.5145 181.086 35.6739 181.086 31.99C181.086 28.3062 181.879 25.4656 183.463 23.4683C185.048 21.471 187.285 20.4723 190.174 20.4723C192.178 20.4723 193.902 21.0937 195.347 22.3365ZM149.955 14.3457H158.281L158.522 21.1369C159.113 19.2146 159.935 17.7218 160.988 16.6585C162.514 15.1166 164.642 14.3457 167.371 14.3457H170.771V21.6146H167.302C165.359 21.6146 163.763 21.8789 162.514 22.4075C161.311 22.9362 160.386 23.7732 159.739 24.9186C159.137 26.064 158.837 27.5178 158.837 29.2799V49.6328H149.955V14.3457ZM111.548 22.2699C110.01 25.0661 109.241 28.3062 109.241 31.99C109.241 35.6739 110.01 38.914 111.548 41.7102C113.086 44.5064 115.229 46.6591 117.979 48.1681C120.729 49.6772 123.944 50.4317 127.626 50.4317C131.634 50.4317 135.176 49.4331 138.252 47.4358C141.327 45.4385 143.425 42.7754 144.543 39.4466L135.385 38.7808C134.686 40.2899 133.638 41.4883 132.24 42.376C130.842 43.2637 129.304 43.7075 127.626 43.7075C124.97 43.7075 122.849 42.8864 121.265 41.2442C119.727 39.5576 118.865 37.2496 118.678 34.3202H145.032V32.2564C144.986 28.2174 144.194 24.7998 142.656 22.0036C141.118 19.2074 139.044 17.0991 136.434 15.6788C133.824 14.2585 130.888 13.5484 127.626 13.5484C123.944 13.5484 120.729 14.3029 117.979 15.812C115.229 17.321 113.086 19.4737 111.548 22.2699ZM133.079 22.3365C134.57 23.668 135.479 25.7762 135.805 28.6612H118.748C119.121 25.9982 120.076 23.9343 121.614 22.4696C123.152 21.0049 125.156 20.2726 127.626 20.2726C129.77 20.2726 131.587 20.9606 133.079 22.3365Z"
            fill="white"
          />
        </svg>
      </div>
    </div>
  );
}

export class SlideErrorBoundary extends Component<Props, State> {
  public state: State = {
    hasError: false,
  };

  public static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  public componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('Slide error:', error, errorInfo);
  }

  public render() {
    if (this.state.hasError) {
      return (
        this.props.fallback || (
          <SlideBackground>
            <div className="flex flex-col items-center gap-8">
              <ErrorTriangle />
              <div className="flex flex-col items-center gap-4">
                <p className="font-sans text-3xl font-bold text-white">
                  Failed to load slide
                </p>
                {this.state.error?.message && (
                  <p className="max-w-lg text-center font-mono text-sm text-[#666]">
                    {this.state.error.message}
                  </p>
                )}
              </div>
            </div>
          </SlideBackground>
        )
      );
    }

    return this.props.children;
  }
}
